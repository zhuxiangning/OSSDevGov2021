一个精心设计的代码审查过程和一种认真对待代码审查的文化可以带来以下好处：
- 检查代码的正确性
- 确保其他工程师可以理解代码变更
- 增强整个代码库的一致性
- 从心理上促进团队主人翁精神
- 实现知识共享
- 提供代码审查本身的历史记录

随着时间的推移，这些好处对一个软件组织来说是至关重要的，并且其中许多好吃不仅对作者有益，而且对评审者也有益。下面的章节将对这些项目中的每一项进行更详细的说明。

**代码正确性**

代码审查的一个明显好处是，它允许审查者检查代码变更的“正确性”。让另一双眼睛看着更改有助于确保这个变更达到了预期的目的。评审人员通常会检查变更是否经过了适当的测试，是否经过适当的设计以及是否可以正确有效地运行。在许多情况下，检查代码正确性就是在检查特定的更改是否会将错误引入代码库。

许多报告指出了代码审查有防止软件未来错误的功效。IBM的一项研究发现，在过程中尽早发现缺陷无疑会减少日后修复这些缺陷所需的时间。只要代码审查过程本身被精简以保持轻量级，在代码评审时间上的投资就可以节省在测试、调试和执行回归上所花费的时间。前提很重要；重量级的代码审查过程，或者不能适当扩展的代码审查过程，是不可持续的。在本章的后面，我们将介绍一些保持过程轻量级的最佳实践。

为了防止对正确性的评估变得主观多于客观，无论是在设计中还是引入的功能上的改变，作者通常会尊重他们的特定方法。评论家不应该因为个人观点的不同而提出替代方案。评审者可以提出替代方案，但前提是这些替代方案能够提高理解力(例如，通过降低复杂性)或功能(例如，通过提高效率)。一般来说，我们鼓励工程师批准那些能够改进代码库的更改，而不是等待对一个更“完美”的解决方案达成共识。这种关注倾向于加速代码审查的速度。

随着工具变得越来越强大，许多正确性检查都是通过静态分析和自动测试等技术自动执行的(尽管工具可能永远不会完全消除基于人的代码检查的价值——更多信息参见第20章)。尽管这种工具有它的局限性，但它确实减少了依赖人的代码审查来检查代码正确性的需要。

也就是说，在最初的代码审查过程中检查缺陷仍然是一般的“shift left”策略的一个重要部分，目的在于尽早发现和解决问题，以便不需要在开发周期的更远处增加成本和资源。代码审查既不是万能的，也不是正确性的唯一检查方法，但它是防止软件中出现此类问题的深度防御的一个要素。因此，代码审查不需要“完美”地获取结果。

令人惊讶的是，检查代码正确性并不是Google从代码审查过程中获得的主要好处。检查代码的正确性通常可以确保所做的变更是有效的，但是更加重要的是确保代码变更是可理解的，并且随着时间的推移和代码库本身的扩展而有意义。为了评估这些方面，我们需要查看除了代码在逻辑上是否“正确”或被理解之外的其他因素。

**代码理解**

代码审查通常是作者以外的其他人检查更改的第一次机会。这种观点允许审查者执行一些即使是最好的工程师也做不到的事情：提供不受作者观点影响的反馈。代码评审是对一个给定的变更是否能被更多人理解的第一次测试。这种观点是至关重要的，因为代码被阅读的次数会比它被写的次数多得多，理解和领悟是非常重要的。

找到一个与作者有不同观点的审查者通常是有用的，特别是一个可能将需要维护或使用变更中提出的代码作为他们工作的一部分的审查员。与审阅者在设计决策方面应该给予作者的尊重不同，使用“客户永远是对的”这句格言来对待关于代码理解方面的问题通常是有用的。在某些方面，你现在得到的任何问题都会随着时间的推移而成倍增加，所以要把每一个关于代码理解的问题都看作是有效的。这并不意味着你需要改变你的方法或逻辑来回应批评，但这确实意味着你可能需要更清楚地解释它。

代码正确性和代码理解力的审查共同构成了另一个工程师的LGTM的主要标准，这也是一个被批准的代码审查所需的批准位之一。当一个工程师将代码审查标记为LGTM时，他们是在说，代码做到了它所说的事情，并且是可以理解的。然而，Google也要求代码是可持续维护的，因此在某些情况下，我们还需要对代码进行额外的批准。

**代码一致性**

在一定程度上，你写的代码将被其他人所依赖，并最终得到维护。许多其他人需要阅读你的代码并理解你的工作。其他人(包括自动化工具)可能需要在你转移到另一个项目后很长时间内重构你的代码。因此，代码需要符合一些一致性标准，这样才能被理解和维护。代码也应该避免过于复杂；简单的代码对其他人来说也更容易理解和维护。在代码审查期间，审查者可以评估这个代码在多大程度上符合代码库本身的标准。因此，代码审查应该采取行动确保代码健康。

出于可维护性的考虑，代码评审的LGTM状态(表明代码的正确性和理解力)与可读性批准的状态是分开的。可读性批准只能由成功通过特定编程语言代码可读性培训的个人授予。例如，Java代码需要获得具有“Java可读性”的工程师的批准。

可读性批准者的任务是审查代码，以确保它遵循该特定编程语言的一致最佳实践，并与Google代码存储库中该语言的代码库保持一致，并避免过于复杂。一致且简单的代码更容易理解，并且在重构时工具更容易更新，使其更具弹性。如果一个特定的模式总是以一种方式在代码库中完成，那么编写一个重构它的工具就更容易了。

此外，代码可能只编写一次，但它将被读取数十次、数百次甚至数千次。在整个代码库中拥有一致的代码可以提高所有工程的理解力，这种一致性甚至影响到代码审查过程本身。一致性有时会与功能性发生冲突；可读性审查者可能更喜欢一个不太复杂的变更，它可能在功能上没有“更好”,但是更容易理解。

有了一个更一致的代码库，工程师可以更轻松地介入和审查其他人项目上的代码。工程师们可能偶尔需要在代码审查中向团队外寻求帮助。能够接触并要求专家审查代码与知道他们可以期望代码本身是一致的，这使得这些工程师能够更恰当地关注代码的正确性和理解力。

**心理和文化好处**

代码审查也有重要的文化好处:它向软件工程师强调代码不是“他们的”，实际上是集体企业的一部分。这种心理上的好处可能很微妙，但仍然是重要的。如果没有代码审查，大多数工程师自然会倾向于个人风格和他们自己的软件设计方法。代码审查过程迫使作者不仅要让其他人提出意见，还要为了更大的利益做出妥协。

以自己的风格为荣，不愿意把自己的代码公开让别人审查批评，这是人类的天性。对于自己编写的代码的批评性反馈，也很自然地不愿意接受。代码审查过程提供了一种机制，来减少可能是充满情感的互动。当代码审查工作做得最好的时候，它不仅对工程师的假设提出挑战，而且以一种规定的、中立的方式进行审查，以缓和任何可能以不请自来的方式提供给作者的批评意见。毕竟，这个过程需要严格的审查(事实上我们称我们的代码审查工具为“批判”)，所以你不能责怪一个审查者做他们的工作并且是严格的。因此，代码审查过程本身可以充当“坏警察”，而审查者仍然可以被视为“好警察”。

当然，并不是所有的工程师，甚至不是大多数工程师都需要这样的心理装置。但是，通过代码审查过程来缓减这种批评，往往能为大多数工程师提供一个更温和的介绍，让他们了解团队的期望。许多加入Google或新团队的工程师被对代码审查感到恐惧。人们很容易认为，任何形式的批评性审查都会对一个人的工作表现产生负面影响。但是随着时间的推移，几乎所有的工程师都开始期待在发送代码审查时受到挑战，并开始重视通过这个过程提供的建议和问题(尽管不得不承认，这有时需要一段时间)。

代码审查的另一个心理好处是验证。即使是最有能力的工程师也可能患上冒名顶替综合症，并且过于自我批评。像代码评审这样的过程是对一个人的工作的验证和认可。通常，该过程涉及思想交流和知识共享(在下一节中讨论)，这对审查者和被审查者都有好处。随着工程师在其领域内知识的增长，他们有时很难获得关于他们如何改进的积极反馈。代码审查过程可以提供这种机制。

启动代码审查的过程也迫使所有作者对他们的变更多加注意。很多软件工程师并不是完美主义者；大多数人都会承认,“能完成工作”的代码比完美但开发时间太长的代码要好。如果没有代码审查，我们中的许多人自然会偷工减料，甚至完全打算在以后纠正这种缺陷。“当然，我没有完成所有的单元测试，但我可以稍后再做。”代码审查迫使工程师在发送变更之前解决这些问题。从心理学角度来说，为代码审查而收集变更的组成部分，迫使工程师确保他们所有的事情都是一帆风顺的。在发送变更前的那一小段思考时间，是阅读变更的最佳时机，以确保你没有遗漏任何东西。

**知识共享**

代码审查一个重要的但被低估的好处是知识共享。大多数作者选择的审查员都是被审查领域的专家，或者至少是知识渊博的。审查过程允许审查者向作者传授领域知识，允许审查者向作者提供建议、新技术或咨询信息。(审查者甚至可以将一些评论标记为“仅供参考”，无需采取任何行动；它们只是作为对作者的帮助而添加的。)对代码库的某一领域特别精通的作者往往也会成为所有者，然后他们又可以作为其他工程师的审查者。

反馈和确认的代码审查过程的一部分包括询问为什么以特定的方式进行变更。这种信息交流有利于知识的共享。事实上，许多代码评审涉及到双向的信息交流：作者和审查者可以从代码审查中学习新的技术和模式。在谷歌，审查者甚至可以直接在代码审查工具中与作者分享建议的编辑内容。

工程师可能不会阅读每一封发给他们的电子邮件，但他们往往会回复每一封发送的代码审查。这种知识共享也可以跨时区和跨项目进行，使用Google的规模将信息迅速传播到代码库的各个角落的工程师。代码审查是知识转移的最佳时机：它是及时和可操作的。(Google的很多工程师都是首先通过代码审查“认识”其他工程师！)

鉴于Google工程师花在代码审查上的时间，积累的知识是相当重要的。当然，Google工程师的主要任务仍然是编程，但他们的很大一部分时间仍然花在代码审查上。代码审查过程提供了软件工程师之间相互交流和交换编码技术信息的主要方式之一。通常情况下，新的模式是在代码审查的背景下宣传的，有时是通过大规模的变更等重构。

此外，由于每一个变更都会成为代码库的一部分，所以代码审查就像一个历史记录。任何工程师都可以审查Google的代码库，并确定何时引入某些特定的模式，并提出有关的实际代码审查。通常情况下，考古学提供给工程师的见解要比原始作者和评论家多得多。

**代码审查最佳实践**

诚然，代码审查会给一个组织带来异议和延迟。但这些问题大多不是代码审查本身的问题，而是他们选择的代码审查实施的问题。在Google保持代码审查过程的顺利运行也不例外，它需要大量的最佳实践来确保代码审查是值得的。这些实践中的大多数都强调要保持流程的灵活性和快速性，以便代码审查可以适当地扩展。

**礼貌和专业性**

正如本书的文化部分所指出的，Google在很大程度上培养了一种信任和尊重的文化。这也渗透到我们对代码审查的看法中。例如，一个软件工程师只需要一个其他工程师的LGTM就可以满足我们对代码理解的要求。许多工程师提出意见，并在LGTM进行变更，他们的理解是，在这些变更完成后，可以提交变更，而不需要任何额外的审查。也就是说，即使是最有能力的工程师，代码审查也会给他们带来焦虑和压力。将所有的反馈和批评牢牢地保持在专业领域内是至关重要的。

一般来说，审查者应该在特定的方法上遵从作者的意见，只有在作者的方法有缺陷时才指出替代方法。如果作者可以证明几种方法同样有效，审查者应该接受作者的偏好。即使在这些情况下，如果发现一个方法有缺陷，也要把审查看作是一个学习的机会（对双方都是如此！）。所有的评论都应该严格保持专业性。审查者应该注意不要根据代码作者的特定方法妄下结论。在假设该方法是错误的之前，最好先问一下作者为什么要这样做。

审查者应及时提供反馈。在Google，我们希望在24小时内收到代码审查的反馈。如果审查者无法在这段时间内完成审查，那么最好的做法是（也是我们所期望的）回应说他们至少已经看到了更改，并会尽快进行审查。审查者应该避免以零散的方式回应代码评审。没有什么事情比从审查中得到反馈，解决它，然后继续在审查过程中得到无关的进一步反馈更让作者恼火。

就像我们期望审查员有专业精神一样，我们也期望作者有专业精神。记住，你不是你的代码，你提出的这个变更不是 "你的"，而是团队的。当你把这段代码放入代码库后，它就不再是你的了。要乐于接受关于你的方法的问题，并准备好解释你为什么以某种方式做事。记住，作者的部分责任是确保这段代码是可以理解的，并且可以在将来维护。

